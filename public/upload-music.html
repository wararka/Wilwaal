<!DOCTYPE html>
<html lang="so">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Soo Gelin Muusig - Wilwaal Studio</title>
    <link rel="stylesheet" href="upload-musik.css">
</head>
<body>
    <div class="container">
        <button class="theme-toggle" id="themeToggle" title="Bedel Habka Midabka">
            üåô
        </button>
        <i>madow/cadaan</i>
        
        <h1>üéôÔ∏è Soo Gelin Muusigga Wilwaal Studio</h1>
        
        <!-- Upload Status Message -->
        <div id="uploadStatus" class="upload-status"></div>
        
        <form id="uploadForm" action="/upload-music" method="POST" enctype="multipart/form-data">
            
            <label for="artistName">Magaca Fanaanka (Waa Waajib):</label>
            <input type="text" id="artistName" name="artistName" required placeholder="Tusaale: Nimcaan Hilaac">
            
            <label for="songTitle">Magaca Heesta (Waa Waajib):</label>
            <input type="text" id="songTitle" name="songTitle" required placeholder="Tusaale: Caashaqa">
            
            <label for="artistImage">Sawirka Fanaanka (Waa Waajib):</label>
            <input type="file" id="artistImage" name="artistImage" accept="image/*" required>
            <small>Qaado sawirka fanaanka (JPG, PNG, JPEG) - Ugu badnaan 5MB</small>
            
            <label for="musicFile">Dooro File Muusig (Audio ama Video):</label>
            <input type="file" id="musicFile" name="musicFile" accept="audio/*,video/*" required>
            <small>Qaado file-ka muusigga (MP3, WAV, MP4, etc) - Ugu badnaan 500MB</small>
            
            <!-- Preview Container -->
            <div id="previewContainer" class="preview-container"></div>
            
            <button type="submit" id="submitBtn">üéµ Soo Geli Muusigga</button>
        </form>

        <div class="form-info">
            <h3>üí° Tilmaamaha Soo Gelinta:</h3>
            <ul>
                <li>‚úÖ Magaca fanaanka waa waajib</li>
                <li>‚úÖ Magaca heesta waa waajib</li>
                <li>‚úÖ Sawirka fanaanka waa waajib</li>
                <li>‚úÖ File-ka muusigga waa waajib</li>
                <li>üéµ Audio: MP3, WAV, OGG</li>
                <li>üé¨ Video: MP4, AVI, MOV</li>
                <li>üñºÔ∏è Sawir: JPG, PNG, JPEG</li>
                <li>üìä Ugu badnaan: Sawir 5MB, Muusig 500MB</li>
            </ul>
        </div>

        <a href="wilwaal-studio.html" class="back-link">‚Üê Dib ugu noqo Wilwaal Studio</a>
    </div>

    <script>
        // =========================================================
        // 1. THEME TOGGLE FUNCTIONALITY
        // =========================================================
        const themeToggle = document.getElementById('themeToggle');
        const currentTheme = localStorage.getItem('theme') || 'dark';
        
        // Initialize theme
        document.documentElement.setAttribute('data-theme', currentTheme);
        updateToggleButton(currentTheme);
        
        themeToggle.addEventListener('click', function() {
            let theme = document.documentElement.getAttribute('data-theme');
            theme = theme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('theme', theme);
            updateToggleButton(theme);
        });
        
        function updateToggleButton(theme) {
            themeToggle.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
        }

        // =========================================================
        // 2. FORM ELEMENTS AND VALIDATION
        // =========================================================
        const uploadForm = document.getElementById('uploadForm');
        const artistImageInput = document.getElementById('artistImage');
        const musicFileInput = document.getElementById('musicFile');
        const artistNameInput = document.getElementById('artistName');
        const songTitleInput = document.getElementById('songTitle');
        const submitBtn = document.getElementById('submitBtn');
        const previewContainer = document.getElementById('previewContainer');
        const uploadStatus = document.getElementById('uploadStatus');

        // =========================================================
        // 3. ARTIST IMAGE PREVIEW AND VALIDATION
        // =========================================================
        artistImageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            previewContainer.innerHTML = '';
            
            if (file) {
                // File type validation
                if (!file.type.startsWith('image/')) {
                    showUploadStatus('‚ùå Fadlan dooro file sawir (JPG, PNG, JPEG)', 'error');
                    this.value = '';
                    return;
                }
                
                // File size validation (5MB max)
                if (file.size > 5 * 1024 * 1024) {
                    showUploadStatus('‚ùå Sawirka waa weyn yahay! Ugu badnaan 5MB', 'error');
                    this.value = '';
                    return;
                }
                
                // Create preview
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewContainer.innerHTML = `
                        <div class="preview-item">
                            <h4>üì∏ Sawirka la dooray:</h4>
                            <img src="${e.target.result}" class="preview-image" alt="Sawirka Fanaanka">
                            <p>${file.name} (${(file.size / 1024 / 1024).toFixed(2)} MB)</p>
                        </div>
                    `;
                    previewContainer.classList.add('show');
                    showUploadStatus('‚úÖ Sawirka waa la aqbalay!', 'success');
                };
                reader.readAsDataURL(file);
            }
        });

        // =========================================================
        // 4. MUSIC FILE VALIDATION AND INFO DISPLAY
        // =========================================================
        musicFileInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            
            if (file) {
                // File type validation
                if (!file.type.startsWith('audio/') && !file.type.startsWith('video/')) {
                    showUploadStatus('‚ùå Fadlan dooro file muusig (Audio ama Video)', 'error');
                    this.value = '';
                    return;
                }
                
                // File size validation (500MB max)
                if (file.size > 500 * 1024 * 1024) {
                    showUploadStatus('‚ùå File-ka muusigga waa weyn yahay! Ugu badnaan 500MB', 'error');
                    this.value = '';
                    return;
                }
                
                // Display file info
                const fileInfo = document.createElement('div');
                fileInfo.className = 'preview-item';
                fileInfo.innerHTML = `
                    <h4>üéµ File-ka Muusigga:</h4>
                    <p><strong>Magac:</strong> ${file.name}</p>
                    <p><strong>Nooc:</strong> ${getFileType(file.type)}</p>
                    <p><strong>Cabbir:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                `;
                
                if (!previewContainer.classList.contains('show')) {
                    previewContainer.appendChild(fileInfo);
                    previewContainer.classList.add('show');
                } else {
                    previewContainer.appendChild(fileInfo);
                }
                
                showUploadStatus('‚úÖ File-ka muusigga waa la aqbalay!', 'success');
            }
        });

        // =========================================================
        // 5. REAL-TIME INPUT VALIDATION
        // =========================================================
        artistNameInput.addEventListener('input', function() {
            validateTextField(this, 'Magaca fanaanka waa waajib');
        });

        songTitleInput.addEventListener('input', function() {
            validateTextField(this, 'Magaca heesta waa waajib');
        });

        function validateTextField(field, errorMessage) {
            if (field.value.trim() === '') {
                field.style.borderColor = 'var(--hacker-danger)';
                field.style.boxShadow = '0 0 10px var(--hacker-danger)';
            } else {
                field.style.borderColor = 'var(--hacker-green)';
                field.style.boxShadow = 'var(--hacker-glow)';
            }
        }

        // =========================================================
        // 6. FORM SUBMISSION HANDLING
        // =========================================================
        uploadForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const artistName = artistNameInput.value.trim();
            const songTitle = songTitleInput.value.trim();
            const artistImage = artistImageInput.files[0];
            const musicFile = musicFileInput.files[0];

            // Validation
            if (!artistName) {
                showUploadStatus('‚ùå Fadlan geli magaca fanaanka', 'error');
                artistNameInput.focus();
                return;
            }

            if (!songTitle) {
                showUploadStatus('‚ùå Fadlan geli magaca heesta', 'error');
                songTitleInput.focus();
                return;
            }

            if (!artistImage) {
                showUploadStatus('‚ùå Fadlan dooro sawirka fanaanka', 'error');
                return;
            }

            if (!musicFile) {
                showUploadStatus('‚ùå Fadlan dooro file-ka muusigga', 'error');
                return;
            }

            // Show loading state
            submitBtn.innerHTML = 'üì§ Soo Gelaya...';
            submitBtn.disabled = true;
            submitBtn.classList.add('loading');

            // Create FormData for file upload
            const formData = new FormData();
            formData.append('artistName', artistName);
            formData.append('songTitle', songTitle);
            formData.append('artistImage', artistImage);
            formData.append('musicFile', musicFile);

            // Submit form via Fetch API
            fetch('/upload-music', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                return response.text();
            })
            .then(data => {
                // Handle successful upload
                showUploadStatus('üéâ Muusigga si guul leh ayaa loo soo geliyay!', 'success');
                submitBtn.innerHTML = '‚úÖ La soo geliyay!';
                
                // Reset form after successful upload
                setTimeout(() => {
                    uploadForm.reset();
                    previewContainer.innerHTML = '';
                    previewContainer.classList.remove('show');
                    submitBtn.innerHTML = 'üéµ Soo Geli Muusigga';
                    submitBtn.disabled = false;
                    submitBtn.classList.remove('loading');
                    
                    // Redirect after 3 seconds
                    setTimeout(() => {
                        window.location.href = 'wilwaal-studio.html';
                    }, 3000);
                }, 2000);
            })
            .catch(error => {
                console.error('Upload error:', error);
                showUploadStatus('‚ùå Khalad: Muusigga lama soo gelin karo', 'error');
                submitBtn.innerHTML = 'üéµ Soo Geli Muusigga';
                submitBtn.disabled = false;
                submitBtn.classList.remove('loading');
            });
        });

        // =========================================================
        // 7. HELPER FUNCTIONS
        // =========================================================
        function showUploadStatus(message, type) {
            uploadStatus.textContent = message;
            uploadStatus.className = `upload-status ${type}`;
            uploadStatus.style.display = 'block';
            
            // Auto-hide success messages after 5 seconds
            if (type === 'success') {
                setTimeout(() => {
                    uploadStatus.style.display = 'none';
                }, 5000);
            }
        }

        function getFileType(mimeType) {
            if (mimeType.startsWith('audio/')) {
                return 'Audio File';
            } else if (mimeType.startsWith('video/')) {
                return 'Video File';
            } else if (mimeType.startsWith('image/')) {
                return 'Sawir';
            } else {
                return 'File';
            }
        }

        // =========================================================
        // 8. DRAG AND DROP FUNCTIONALITY (BONUS)
        // =========================================================
        const fileInputs = [artistImageInput, musicFileInput];
        
        fileInputs.forEach(input => {
            input.addEventListener('dragenter', function(e) {
                e.preventDefault();
                this.parentElement.style.background = 'rgba(0, 136, 255, 0.2)';
            });
            
            input.addEventListener('dragleave', function(e) {
                e.preventDefault();
                this.parentElement.style.background = '';
            });
            
            input.addEventListener('dragover', function(e) {
                e.preventDefault();
            });
            
            input.addEventListener('drop', function(e) {
                e.preventDefault();
                this.parentElement.style.background = '';
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    this.files = files;
                    this.dispatchEvent(new Event('change'));
                }
            });
        });

        // =========================================================
        // 9. KEYBOARD SHORTCUTS
        // =========================================================
        document.addEventListener('keydown', function(e) {
            // Ctrl + Enter to submit form
            if (e.ctrlKey && e.key === 'Enter') {
                uploadForm.dispatchEvent(new Event('submit'));
            }
            
            // Escape to go back
            if (e.key === 'Escape') {
                window.location.href = 'wilwaal-studio.html';
            }
        });

        // =========================================================
        // 10. PROGRESS INDICATOR (Advanced Feature)
        // =========================================================
        function setupProgressIndicator() {
            // This would be implemented with XMLHttpRequest for progress tracking
            console.log('Progress tracking ready');
        }

        // Initialize progress tracking
        setupProgressIndicator();

    </script>
</body>
</html>